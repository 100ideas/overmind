import { derived } from 'overmind'
import { State } from './state'

export const currentApp = derived(
  (state: State) => state.apps[state.currentPort]
)

export const componentsMounted = derived((state: State) =>
  Object.keys(state.currentApp.components).reduce((aggr, key) => {
    if (state.currentApp.components[key].isMounted) {
      return aggr.concat(state.currentApp.components[key])
    }

    return aggr
  }, [])
)

export const componentsUpdateCount = derived((state: State) =>
  state.componentsMounted.reduce(
    (aggr, component) => aggr + component.updateCount,
    0
  )
)

export const componentsStatePathCount = derived((state: State) =>
  state.componentsMounted.reduce(
    (aggr, component) => aggr + component.paths.length,
    0
  )
)
