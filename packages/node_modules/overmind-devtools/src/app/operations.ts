import { Map, Filter, Do } from '../app'
import { Apps } from './state'

export const getAppsFromStorage: Map<any, Promise<Apps>> = ({ storage }) =>
  storage.get<Apps>('apps')

export const confirm: (text: string) => Filter = (text) => ({ utils }) =>
  utils.confirmDialog(text)

export const getCurrentPortFromStorage: Map<any, Promise<string>> = ({
  storage,
}) => storage.get<string>('currentPort')

export const getNewPortFromState: Map<any, string> = ({ state }) =>
  state.newPortValue

export const storeApps: Do = ({ storage, state }) =>
  storage.set('apps', state.apps)

export const toNumber: Map<string, string> = (_, value) => String(Number(value))

export const connectCurrentPort: (action: (message: any) => void) => Do = (
  action
) => ({ state, connector }) => {
  if (!state.currentPort) {
    return
  }

  connector.addPort(state.currentPort, action)
}

export const removeCurrentPort: Do = ({ state, connector }) =>
  connector.removePort(state.currentPort)
