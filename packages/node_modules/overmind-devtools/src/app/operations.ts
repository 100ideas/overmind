import { Operation } from 'overmind'
import { Apps } from './state'

export const getAppsFromStorage: Operation.Map<any, Promise<Apps>> = ({
  storage,
}) => storage.get<Apps>('apps')

export const confirm: (text: string) => Operation.Filter = (text) => ({
  utils,
}) => utils.confirmDialog(text)

export const getCurrentPortFromStorage: Operation.Map<any, Promise<string>> = ({
  storage,
}) => storage.get<string>('currentPort')

export const getNewPortFromState: Operation.Map<any, string> = ({ state }) =>
  state.newPortValue

export const storeApps: Operation.Do = ({ storage, state }) =>
  storage.set('apps', state.apps)

export const toNumber: Operation.Map<string, string> = (_, value) =>
  String(Number(value))

export const connectCurrentPort: (
  action: (message: any) => void
) => Operation.Do = (action) => ({ state, connector }) => {
  if (!state.currentPort) {
    return
  }

  connector.addPort(state.currentPort, action)
}

export const removeCurrentPort: Operation.Do = ({ state, connector }) =>
  connector.removePort(state.currentPort)
