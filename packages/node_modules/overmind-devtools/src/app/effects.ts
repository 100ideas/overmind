import * as jsonStorage from 'electron-json-storage'
import BackendConnector from 'overmind-devtools/src/BackendConnector'

export const connector = new BackendConnector()

export const utils = {
  confirmDialog(text): boolean {
    return window.confirm(text)
  },
}

export const storage = {
  clear() {
    return new Promise((resolve, reject) => {
      jsonStorage.clear((error) => {
        if (error) {
          reject(error)
        } else {
          resolve()
        }
      })
    })
  },
  get<T>(key: string): Promise<T> {
    return new Promise((resolve, reject) => {
      jsonStorage.get(key, (err, data) => {
        if (err) {
          reject(err)
        } else {
          resolve(
            // Insanely weird that when "no value", an empty
            // object is returned. Should be null
            typeof data === 'object' &&
            !Array.isArray(data) &&
            data !== null &&
            Object.keys(data).length === 0
              ? null
              : data
          )
        }
      })
    })
  },
  set(key, data) {
    return new Promise((resolve, reject) => {
      jsonStorage.set(key, data, (err) => {
        if (err) {
          reject(err)
        } else {
          resolve()
        }
      })
    })
  },
}
