import { createMock, TAction } from './'

type State = {
  foo: string
  upperFoo: string
}

describe('Mock', () => {
  test('should run action tests', () => {
    type State = {
      foo: string
    }
    const state: State = {
      foo: 'bar',
    }
    const test: Action = ({ state, effect }) => {
      state.foo = effect()
    }
    const actions = { test }
    const effect = () => 'bar2'
    const effects = { effect }
    const config = {
      state,
      actions,
      effects,
    }

    type Config = {
      state: typeof state
      actions: typeof actions
      effects: typeof effects
    }

    type Action<Input = void> = TAction<Config, Input>

    const mock = createMock(config, {
      effect() {
        return 'bar3'
      },
    })

    return mock.actions.test().then((result) =>
      expect(result).toEqual([
        {
          method: 'set',
          path: 'foo',
          args: ['bar3'],
        },
      ])
    )
  })
})
